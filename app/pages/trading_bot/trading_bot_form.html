<form method="post">
    {{ form.hidden_tag() }}



    <div class="container">
        <div class="row">

            <div class="col-md-12">
                <fieldset class="border border-dark p-2">
                    <legend class="w-auto">Main Properties</legend>
                    <div class="form-group">
                        {{ form.name.label }} {{ form.name(size=32, class="form-control") }}
                    </div>
                    <div class="form-group">
                        {{ form.base_asset.label }} {{ form.base_asset(size=32, class="form-control") }}
                    </div>
                    <div class="form-group">
                        {{ form.quote_asset.label }} {{ form.quote_asset(size=32, class="form-control") }}
                    </div>
                    <div class="form-group">
                        {{ form.exchange_id.label }}
                        {{ form.exchange_id(class="form-control") }}
                    </div>

                    <div class="form-group">
                        {{ form.trade_size.label }} {{ form.trade_size(size=32, class="form-control") }}
                    </div>

                    <div class="form-group">
                        <span class="badge badge-pill badge-danger mb-3">Not Ready</span>
                        {{ form.bot_type.label }}
                        {{ form.bot_type(class="form-control") }}
                    </div>
                </fieldset>
            </div>

            <div class="col-md-6">
                <fieldset class="border border-dark p-2">
                    <legend class="w-auto">Stop Loss</legend>
                    <div class="form-group">
                        {{ form.use_stop_loss.label() }}
                        {{ form.use_stop_loss() }}
                        <br />
                        {{ form.stop_loss_percentage.label(class="form-label") }}
                        {{ form.stop_loss_percentage(class="form-control") }}
                        <br />
                        <span class="badge badge-pill badge-danger mb-3">Not Ready</span>
                        {{ form.trailing_stop_loss.label() }}
                        {{ form.trailing_stop_loss() }}
                        <br />
                        <span class="badge badge-pill badge-danger mb-3">Not Ready</span>
                        {{ form.stop_loss_timeout.label(class="form-label") }}
                        {{ form.stop_loss_timeout(class="form-control") }}
                    </div>
                </fieldset>
            </div>

            <div class="col-md-6">
                <fieldset class="border border-dark p-2">
                    <legend class="w-auto">Take Profit</legend>
                    <div class="form-group">
                        {{ form.use_take_profit.label() }}
                        {{ form.use_take_profit() }}
                        <br />
                        {{ form.take_profit_percentage.label(class="form-label") }}
                        {{ form.take_profit_percentage(class="form-control") }}
                        <br />
                        <span class="badge badge-pill badge-danger mb-3">Not Ready</span>
                        {{ form.trailing_take_profit.label() }}
                        {{ form.trailing_take_profit() }}
                        <br />
                        <span class="badge badge-pill badge-danger mb-3">Not Ready</span>
                        {{ form.trailing_take_profit_deviation_percentage.label(class="form-label") }}
                        {{ form.trailing_take_profit_deviation_percentage(class="form-control") }}
                    </div>
                </fieldset>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <fieldset class="border border-dark p-2">
                    <legend class="w-auto">Extra Orders</legend>
                    <div class="form-group">
                        {{ form.extra_order_first_volume_scale.label(class="form-label") }}
                        {{ form.extra_order_first_volume_scale(class="form-control") }}
                        <br />
                        {{ form.extra_orders_count.label(class="form-label") }}
                        {{ form.extra_orders_count(class="form-control") }}
                        <br />
                        {{ form.extra_order_first_deviation_percentage.label(class="form-label") }}
                        {{ form.extra_order_first_deviation_percentage(class="form-control") }}
                        <br />
                        {{ form.extra_order_step_volume_scale.label(class="form-label") }}
                        {{ form.extra_order_step_volume_scale(class="form-control") }}
                        <br />
                        {{ form.extra_order_step_deviation_scale.label(class="form-label") }}
                        {{ form.extra_order_step_deviation_scale(class="form-control") }}
                    </div>
                </fieldset>
            </div>
            <div class="col-md-6">
                <fieldset class="border border-dark p-2">
                    <legend class="w-auto">Start Conditions</legend>
                    <div class="form-group">

                        <div id="start_conditions">
                            {% for indicator in form.start_conditions %}
                            {{ indicator.form.hidden_tag() }}
                            <div class="indicator">
                                {{ indicator.form.type(class="form-control") }}
                                <br>
                                <div class="parameters">
                                    <div class="none"></div>
                                    <div class="bollinger_bands">
                                        <div class="row">
                                            <div class="col-md-6 form-group">
                                                {{ indicator.form.bollinger_bands.use_to_open.label() }}
                                                {{ indicator.form.bollinger_bands.use_to_open() }}
                                            </div>
                                            <div class="col-md-6 form-group">
                                                {{ indicator.form.bollinger_bands.use_to_close.label() }}
                                                {{ indicator.form.bollinger_bands.use_to_close() }}
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 form-group">
                                                {{ indicator.form.bollinger_bands.period.label }}
                                                {{ indicator.form.bollinger_bands.period(size=24, class="form-control") }}
                                            </div>
                                            <div class="col-md-6 form-group">
                                                {{ indicator.form.bollinger_bands.stddev.label }}
                                                {{ indicator.form.bollinger_bands.stddev(size=24, class="form-control") }}
                                            </div>
                                        </div>
                                    </div>

                                    <div class="rsi">
                                        <div class="row">
                                            <div class="col-md-6 form-group">
                                                {{ indicator.form.rsi.use_to_open.label() }}
                                                {{ indicator.form.rsi.use_to_open() }}
                                            </div>
                                            <div class="col-md-6 form-group">
                                                {{ indicator.form.rsi.use_to_close.label() }}
                                                {{ indicator.form.rsi.use_to_close() }}
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4 form-group">
                                                {{ indicator.form.rsi.period.label }}
                                                {{ indicator.form.rsi.period(size=24, class="form-control") }}
                                            </div>
                                            <div class="col-md-4 form-group">
                                                {{ indicator.form.rsi.overbought.label }}
                                                {{ indicator.form.rsi.overbought(size=24, class="form-control") }}
                                            </div>
                                            <div class="col-md-4 form-group">
                                                {{ indicator.form.rsi.oversold.label }}
                                                {{ indicator.form.rsi.oversold(size=24, class="form-control") }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        <!-- <button type="button" id="add-indicator">Add Indicator</button><br><br> -->
                    </div>
                </fieldset>
            </div>
        </div>
    </div>


    <button type="submit" class="btn btn-primary">Submit</button>
</form>

<script>
    $(document).ready(function () {

        // Iterate over each indicator
        $('.indicator').each(function() {
            var typeSelect = $(this).find('select[name$="type"]'); // Find the select box with name "type"
            var selectedType = typeSelect.val(); // Get the value of the select box
            
            // Hide all parameter rows within the indicator
            $(this).find('.parameters > div').hide();
            
            // Show the parameter row corresponding to the selected type
            $(this).find('.' + selectedType).show();
            
            // Update the parameter row when the select box value changes
            typeSelect.change(function() {
                var newSelectedType = $(this).val(); // Get the new selected value
                $(this).closest('.indicator').find('.parameters > div').hide(); // Hide all parameter rows
                $(this).closest('.indicator').find('.' + newSelectedType).show(); // Show the corresponding parameter row
            });
        });
    });
</script>